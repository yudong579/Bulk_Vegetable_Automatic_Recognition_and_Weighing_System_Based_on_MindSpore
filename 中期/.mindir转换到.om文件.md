针对 **Atlas 200I DK A2 开发板**（全新未配置），从初始状态到完成 `.mindir` 转 `.om` 格式的完整流程如下，包含硬件连接、系统部署、环境配置及模型转换全步骤：


### 一、硬件准备与连接
Atlas 200I DK A2 开发板需要以下硬件配件（需自行准备）：
- 12V/2A 直流电源（带 5.5mm 接口）
- microSD 卡（建议 32GB 及以上，Class 10 级别）
- 网线（用于联网和 SSH 登录）
- 电脑（Windows 或 Linux，用于烧录系统、串口调试）
- USB 转串口线（如 CH340 芯片，用于初始登录开发板）

**连接步骤**：
1. 将 microSD 卡插入开发板底部的 SD 卡槽（注意方向，避免损坏引脚）。
2. 用 USB 转串口线连接开发板的 **DEBUG 串口**（开发板上标有“DEBUG”的 4 针接口，定义：1-GND、2-TX、3-RX、4-VCC，仅需连接 GND、TX、RX 到 USB 转串口线的对应引脚）。
3. 用网线连接开发板的 **ETH 网口** 到路由器或电脑（确保与电脑同局域网）。
4. 最后连接 12V 电源（先插电源适配器，再开开发板电源开关，避免电流冲击）。


### 二、烧录开发板系统镜像
Atlas 200I DK A2 需安装官方定制的 Ubuntu 系统，步骤如下：

#### 1. 下载系统镜像
从昇腾官网下载 **Atlas 200I DK A2 专用系统镜像**（需注册账号）：  
[昇腾开发者社区 - 资源中心](https://www.hiascend.com/developer/resources)  
> 推荐版本：`Ubuntu 20.04`（需匹配后续软件栈版本，镜像名通常包含“Atlas-200I-DK-A2”字样）

#### 2. 烧录镜像到 SD 卡
使用工具将镜像写入 SD 卡：
- **Windows**：使用 [BalenaEtcher](https://www.balena.io/etcher/)（简单易用，支持直接烧录 `.img` 文件）。
- **Linux**：使用 `dd` 命令（需注意设备路径，避免误操作）：
  ```bash
  sudo dd if=./Atlas-200I-DK-A2-ubuntu20.04.img of=/dev/sdX bs=4M status=progress
  ```
  （`/dev/sdX` 需替换为 SD 卡的设备路径，可通过 `lsblk` 查看）

#### 3. 首次启动开发板
将烧录好的 SD 卡插入开发板，通电开机，观察开发板上的 LED 灯：
- 电源灯（PWR）常亮表示供电正常。
- 网口灯（ETH）闪烁表示网络连接正常。


### 三、开发板初始配置（通过串口登录）
#### 1. 电脑端安装串口驱动
- 若使用 CH340 芯片的 USB 转串口线，需安装 [CH340 驱动](https://www.wch.cn/downloads/CH341SER_EXE.html)。
- 安装完成后，在电脑设备管理器（Windows）或 `ls /dev/ttyUSB*`（Linux）中确认串口端口（如 `COM3` 或 `/dev/ttyUSB0`）。

#### 2. 用串口工具登录开发板
使用串口工具（如 PuTTY、Xshell 或 minicom）连接：
- **波特率**：115200  
- **数据位**：8  
- **停止位**：1  
- **校验位**：无  
- **流控**：无  

连接成功后，按开发板复位键（RESET），终端会显示启动日志，最终出现登录提示：
```
Ubuntu 20.04 LTS localhost login:
```
- 初始用户名：`HwHiAiUser`  
- 初始密码：`Mind@123`（首次登录需修改密码，按提示设置新密码）

#### 3. 配置网络（获取 IP 地址）
登录后，执行以下命令查看开发板 IP 地址：
```bash
ifconfig eth0
```
记录 `inet` 后的 IP（如 `192.168.1.100`），后续可通过 SSH 登录（更方便操作）：
```bash
# 电脑端 SSH 登录（替换为实际 IP）
ssh HwHiAiUser@192.168.1.100
```


### 四、安装昇腾 AI 软件栈（关键步骤）
昇腾 AI 软件栈包含 ATC 工具（模型转换必需），需按以下步骤安装：

#### 1. 配置软件源
官方已为 Atlas 200I DK A2 提供专用源，执行以下命令添加（确保开发板联网）：
```bash
# 备份原有源（可选）
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

# 添加昇腾源（针对 Ubuntu 20.04）
echo "deb [trusted=yes] https://repo.huaweicloud.com/ascend/aarch64/22.0.0/ubuntu20.04/ /" | sudo tee /etc/apt/sources.list.d/ascend.list

# 更新源
sudo apt update
```

#### 2. 安装依赖包
```bash
sudo apt install -y gcc g++ make cmake unzip zlib1g-dev libssl-dev libopencv-dev
```

#### 3. 安装昇腾驱动、固件和开发套件
Atlas 200I DK A2 的 SOC 为 **Ascend 310B**，需安装对应版本的软件栈：
```bash
# 安装驱动和固件（关键组件）
sudo apt install -y ascend-driver ascend-firmware

# 安装开发套件（包含 ATC 工具）
sudo apt install -y ascend-toolkit-22.0.0  # 版本号需与源中一致
```

#### 4. 配置环境变量
安装完成后，需配置昇腾工具链的环境变量：
```bash
# 编辑 .bashrc 文件
vi ~/.bashrc

# 在文件末尾添加以下内容（按 i 进入编辑模式）
export ASCEND_HOME=/usr/local/Ascend
export PATH=$ASCEND_HOME/atc/ccec_compiler/bin:$ASCEND_HOME/atc/bin:$PATH
export LD_LIBRARY_PATH=$ASCEND_HOME/atc/lib64:$LD_LIBRARY_PATH

# 保存退出（按 Esc，输入 :wq 回车），生效环境变量
source ~/.bashrc
```

#### 5. 验证 ATC 工具安装
执行以下命令，若输出版本信息则表示安装成功：
```bash
atc --version
# 预期输出：ATC version: 22.0.0.B030 (或类似版本号)
```


### 五、安装 MindSpore 环境（处理 .mindir 模型）
需安装与昇腾软件栈兼容的 MindSpore 版本（推荐 1.9.0 及以上，适配 Ascend 310B）：

#### 1. 安装 Python 及 pip
```bash
sudo apt install -y python3.8 python3.8-dev python3-pip
sudo ln -s /usr/bin/python3.8 /usr/bin/python  # 建立软链接
```

#### 2. 安装 MindSpore 昇腾版本
```bash
# 安装指定版本（需与昇腾软件栈兼容，参考官网兼容性列表）
pip3 install mindspore-ascend==1.9.0 --trusted-host https://pypi.tuna.tsinghua.edu.cn
```

#### 3. 验证 MindSpore 安装
```bash
python -c "import mindspore; print(mindspore.__version__)"
# 预期输出：1.9.0
```


### 六、.mindir 转 .om 格式（核心步骤）
假设已通过 SSH 将 `.mindir` 模型文件（如 `model.mindir`）上传到开发板的 `~/models` 目录。

#### 1. 验证 .mindir 模型有效性
创建 Python 脚本 `check_mindir.py`：
```python
import mindspore as ms
import numpy as np
from mindspore import Tensor

# 加载模型
graph = ms.load("~/models/model.mindir")
model = ms.Model(graph)

# 构造输入（需匹配模型实际输入形状，示例为 [1,3,224,224]）
input_data = Tensor(np.random.randn(1, 3, 224, 224).astype(np.float32))

# 验证推理
try:
    output = model.predict(input_data)
    print(f"模型验证成功，输出形状：{output.shape}")
except Exception as e:
    print(f"模型无效：{e}")
```
执行脚本：
```bash
python check_mindir.py
```
若输出“模型验证成功”，则可继续转换。

#### 2. 使用 ATC 工具转换格式
执行以下命令（根据模型实际参数调整）：
```bash
atc \
--model=~/models/model.mindir \  # 输入 .mindir 路径
--framework=5 \                  # 固定为 5（MindSpore）
--output=~/models/model_om \     # 输出 .om 路径（无需加后缀）
--soc_version=Ascend310B \       # Atlas 200I DK A2 对应 SOC 型号
--input_shape="input:1,3,224,224" \  # 输入节点名:形状（需与模型一致）
--input_format=NCHW              # 输入格式（通常为 NCHW）
```
- 若模型有多个输入，`--input_shape` 格式为 `"input1:shape1,input2:shape2"`。
- 转换成功会显示 `ATC run success`，并在输出路径生成 `model_om.om` 文件。

#### 3. 验证 .om 模型
使用昇腾推理工具 `msame` 验证（已包含在软件栈中）：
```bash
# 生成随机输入并推理
msame --model=~/models/model_om.om \
      --input="" \  # 空表示使用随机输入
      --output=~/models/result \
      --outfmt=BIN

# 若输出 "Inference is done"，则模型可用
```


### 七、常见问题解决
1. **ATC 命令找不到**：  
   检查环境变量配置是否正确，执行 `source ~/.bashrc` 重新生效。

2. **依赖包安装失败**：  
   确保开发板联网，尝试更换源（如华为云、清华源）。

3. **模型转换时报算子不支持**：  
   参考 [昇腾算子支持列表](https://www.hiascend.com/document/detail/zh/算子列表/index.html)，确认模型中算子是否支持，或升级软件栈版本。

4. **SSH 连接超时**：  
   检查开发板 IP 地址是否正确，网线是否连接，可通过串口登录后执行 `ping 百度.com` 测试网络。


### 八、参考文档
- [Atlas 200I DK A2 快速入门](https://www.hiascend.com/document/detail/zh/atlas200idka2/23.0.RC1/quickstart/intro/intro_0000001505237565.html)
- [昇腾 ATC 工具使用指南](https://www.hiascend.com/document/detail/zh/ascenddeployer/23.0.RC1/atc/index.html)
- [MindSpore 昇腾版本安装](https://www.mindspore.cn/install)

按以上步骤操作，即可从全新开发板开始，完成从 `.mindir` 到 `.om` 的模型转换全流程。